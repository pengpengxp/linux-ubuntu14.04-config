#!/bin/sh
#脚本作者zsl1005,这个只实现了登录的基本功能，欢迎引用修改。

cd $(dirname $0)
#请在下面填上自己的账号和密码
user=15310614657@cqupt
password=211219


interface=wlan0
INTERGATEWAY=172.31.0.1   	# the gateway of cqupt


if test -z $user || test -z $password
	then echo 用户名和密码信息缺失，请修改xkin文件，添加用户名和和密码
	exit 0
fi
count=0
maxcount=10
realusername=`/home/netp/open_keeper/ex_C++`
echo $realusername
rm -f /etc/ppp/peers/dsl-provider
poff -a > /dev/null

until test -n "`ifconfig | grep ppp`" || [ "$count" -eq "$maxcount" ]
do
	if [ "$count" != 0 ]
		then echo "第$count次登录失败"
	fi
	cp HFDial.pppoe temp
	echo "plugin rp-pppoe.so wlan0" >> temp
	echo "user \"$realusername\"" >> temp
	echo "password \"$password\"" >> temp
	mv temp /etc/ppp/peers/dsl-provider
	pon dsl-provider
	# > /dev/null
	count=`expr $count + 1`
	if [ "$count" -eq "$maxcount" ]
	then echo "达到最大失败次数，请检查账户密码信息，或者稍后再试"
	exit 0
	fi
	sleep 1
done
echo "login ok"


echo "add the shangjiao to the route path"
##add ftp://ftp.sjtu.edu.cn to the route path
##shangjiao
route add -net 202.38.97.0 netmask 255.255.255.0 dev $interface gw $INTERGATEWAY
echo "add the beijiao to the route path"
##beijiaotong
route add -net 202.112.154.0 netmask 255.255.255.0 dev $interface gw $INTERGATEWAY
echo "add the qinghua to the route path"
##qinghua
route add -net 166.111.8.0 netmask 255.255.255.0 dev $interface gw $INTERGATEWAY
echo "add the cqupt to the route path"
##cqupt
route add -net 202.202.43.0 netmask 255.255.255.0 dev $interface gw $INTERGATEWAY
route add -net 202.202.32.0 netmask 255.255.255.0 dev $interface gw $INTERGATEWAY
route add -net 172.16.0.0 netmask 255.240.0.0 dev $interface gw $INTERGATEWAY
echo "add the 163 to the route path"
##163
route add -net 123.58.173.0 netmask 255.255.255.0 dev $interface gw $INTERGATEWAY

echo "set your DNS..."
echo "# Generated by NetworkManager"> /etc/resolv.conf
echo "nameserver 202.202.32.33">>/etc/resolv.conf
echo "nameserver 61.128.128.68">>/etc/resolv.conf


echo "delete the default route..."
route del default
echo "add the ppp0 interface as default route..."
route add default dev ppp0

echo "OK,enjoy yourself..."


exit 0
